{!-- ============================================================================= 
     Partial: Archive - a list of posts organised by category for a given channel 
	 –––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
     - Extends block:content
     - pass in {stash:channel}
	 - see https://github.com/croxton/Stash/wiki/Listing-entries-per-category
     ============================================================================= --}

{exp:channel:entries 
    channel="{stash:channel}" 
    dynamic="no" 
    disable="member_data|pagination|category_fields"}
    {categories}
      	{exp:stash:append_list name="entries" context="{category_id}"}
       		{stash:title}{title}{/stash:title}
            {stash:entry_id}{entry_id}{/stash:entry_id}
            {stash:url_title}{url_title}{/stash:url_title}
			{stash:subtitle}{post_subtitle}{/stash:subtitle}
			{stash:date}{entry_date format="%F %d, %Y"}{/stash:date}
			{stash:author}{author}{/stash:author}
			{stash:author_id}{author_id}{/stash:author_id}
      	{/exp:stash:append_list}
    {/categories}
{/exp:channel:entries}

{exp:channel:categories channel="{stash:channel}" style="linear" disable="category_fields" show_empty="no"}
<section>

    <div class="col-md-3">
        <h2 class="section-title">{category_name}</h2>
    </div>

    <div class="col-md-9">
        <ul class="post-list">
        	{exp:stash:get_list name="entries" context="{category_id}"}
            <li>
                <article>
                    <a href="/{stash:channel}/{url_title}">
                        <h2 class="post-title">
                            {title}
                        </h2>
                        {if subtitle}
                        <h3 class="post-subtitle">
                            {subtitle}
                        </h3>
                        {/if}
                    </a>
                    <p class="post-meta">Posted by <a href="/profile/{author_id}">{author}</a> {date}</p>
                <article>
            </li>
            {/exp:stash:get_list}
        </ul>
    </div>

</section>
{/exp:channel:categories}